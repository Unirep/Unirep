---
title: Subgraph
---

export const contractVersion = require('@unirep/core/package.json').version
export const urlBase = 'https://api.studio.thegraph.com/query/48080'
export const NetworkURL = {
    Goerli: urlBase + '/goerli/v' + contractVersion,
    Sepolia: urlBase + '/sepolia/v' + contractVersion,
    ArbitrumGoerli: urlBase + '/arbitrum-goerli/v' + contractVersion,
    OptimismGoerli: urlBase + '/optimism-goerli/v' + contractVersion,
    Mumbai: urlBase + '/mumbai/v' + contractVersion,
}

[The Graph](https://thegraph.com/) is a protocol for indexing networks like Ethereum and IPFS. Site owners publish subgraphs that expose site data for anyone to query. UniRep's subgraph allows you to retrieve data from the <a href={`https://github.com/Unirep/Unirep/blob/v${contractVersion}/packages/contracts/contracts/Unirep.sol`}>`Unirep.sol`</a> smart contract.

:::info
The Graph protocol uses the [GraphQL](https://graphql.org/) query language. For examples, see the [GraphQL API documentation](https://thegraph.com/docs/en/querying/graphql-api/).
:::

## Deployment

<p>
    UniRep subgraph version {contractVersion} is deployed on the following
    networks
</p>

<table>
    <tr>
        <th>Network</th>
        <th>API</th>
    </tr>
    <tr>
        <td>Goerli</td>
        <td>
            <a href={`${NetworkURL.Goerli}`}>{NetworkURL.Goerli}</a>
        </td>
    </tr>
    <tr>
        <td>Sepolia</td>
        <td>
            <a href={`${NetworkURL.Sepolia}`}>{NetworkURL.Sepolia}</a>
        </td>
    </tr>
    <tr>
        <td>Arbitrum Goerli</td>
        <td>
            <a href={`${NetworkURL.ArbitrumGoerli}`}>
                {NetworkURL.ArbitrumGoerli}
            </a>
        </td>
    </tr>
    <tr>
        <td>Optimism Goerli</td>
        <td>
            <a href={`${NetworkURL.OptimismGoerli}`}>
                {NetworkURL.OptimismGoerli}
            </a>
        </td>
    </tr>
    <tr>
        <td>Polygon Mumbai</td>
        <td>
            <a href={`${NetworkURL.Mumbai}`}>{NetworkURL.Mumbai}</a>
        </td>
    </tr>
</table>

## Query Examples

1. Query the top 100 attesters (by default).

```graphql
query MyQuery {
    attesters {
        attesterId
        blockNumber
        epochLength
        startTimestamp
        transactionHash
    }
}
```

2. Query the top 100 users from a certain attester ID.

```graphql
query MyQuery {
    users(
        where: {
            attesterId: "812064237485286466066480536294992408637941768146"
        }
    ) {
        commitment
    }
}
```

3. Query the top 100 state tree leaves which is sorted by index.

```graphql
query MyQuery {
    stateTreeLeaves(
        orderBy: index
        where: {
            attesterId: "812064237485286466066480536294992408637941768146"
            epoch: "1"
        }
    ) {
        leaf
    }
}
```

## Schema

### Attestation

-   `id`: An id to avoid data collision
-   `epoch`: The epoch where an attestation happens
-   `epochKey`: The receiver's epoch key
-   `attesterId`: The attester address
-   `fieldIndex`: Which index of the data fields changes
-   `change`: The change number of the data
-   `blockNumber`: The attestation transaction happens in which block number
-   `blockTimestamp`: The attestation transaction happens in which block timestamp
-   `transactionHash`: The attestation transaction hash

### StateTreeLeaf

-   `id`: An id to avoid data collision
-   `epoch`: The epoch where the state tree leaf emits
-   `leaf`: The emitted state tree leaf
-   `index`: The index of the state tree leaf in the certain epoch
-   `attesterId`: The attester address
-   `blockNumber`: The transaction happens in which block number
-   `blockTimestamp`: The transaction happens in which block timestamp
-   `transactionHash`: The transaction hash

### EpochTreeLeaf

-   `id`: An id to avoid data collision
-   `epoch`: The epoch where the epoch tree leaf emits
-   `leaf`: The emitted epoch tree leaf
-   `index`: The index of the epoch tree leaf in the certain epoch
-   `attesterId`: The attester address
-   `blockNumber`: The transaction happens in which block number
-   `blockTimestamp`: The transaction happens in which block timestamp
-   `transactionHash`: The transaction hash

### HistoryTreeLeaf

-   `id`: An id to avoid data collision
-   `leaf`: The emitted history tree leaf
-   `attesterId`: The attester address
-   `blockNumber`: The transaction happens in which block number
-   `blockTimestamp`: The transaction happens in which block timestamp
-   `transactionHash`: The transaction hash

### Epoch

-   `id`: An id to avoid data collision
-   `number`: The ended epoch number
-   `attesterId`: The attester address
-   `blockNumber`: The transaction happens in which block number
-   `blockTimestamp`: The transaction happens in which block timestamp
-   `transactionHash`: The transaction hash

### Nullifier

-   `id`: An id to avoid data collision
-   `epoch`: The nullifier is emitted in which epoch
-   `attesterId`: The attester address
-   `nullifier`: The nullifier which is used to prevent double user state transition
-   `blockNumber`: The transaction happens in which block number
-   `blockTimestamp`: The transaction happens in which block timestamp
-   `transactionHash`: The transaction hash

### User

-   `id`: An id to avoid data collision
-   `commitment`: The Semaphore identity commitment
-   `epoch`: The signup epoch
-   `attesterId`: The attester address which signs up the user
-   `leafIndex`: The state tree leaf of the signup event
-   `blockNumber`: The transaction happens in which block number
-   `blockTimestamp`: The transaction happens in which block timestamp
-   `transactionHash`: The transaction hash

### Attester

-   `id`: An id to avoid data collision
-   `attesterId`: The attester address
-   `startTimestamp`: The time of the first epoch of the attester starts
-   `epochLength`: The length of each epoch of the attester
-   `blockNumber`: The transaction happens in which block number
-   `blockTimestamp`: The transaction happens in which block timestamp
-   `transactionHash`: The transaction hash
